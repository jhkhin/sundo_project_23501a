<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.postgres.sample.service.impl.dao.lkh.LKH_WaterResourcesDAO">
	
	
    <select id="SelectWaterResourceList" resultType="waterResources"  parameterType="waterResources">
			SELECT *
			FROM
			    (
			        SELECT
			            ROW_NUMBER() OVER() AS rn,
			            a.*
			        FROM
			            (
			                SELECT
			                    w.*,
			                    o.org_name,
			                    o.org_area,
			                    code.cate_name
			                FROM
			                    water_resources w
			                    INNER JOIN organization o ON w.org_code = o.org_code
			                    INNER JOIN (
			                        SELECT * 
			                        FROM CODE 
			                        WHERE field_name = 'facility_type'
			                    ) code ON w.facility_type = code.cate_code
			                ORDER BY
			                    code.cate_name
			            ) a
			    ) 
		OFFSET #{start}-1
		LIMIT 10
    </select>
	
	
	<select id="countWaterResource"  resultType="waterResources">
			select 
				count(*) as total
			from 
				water_resources w, organization o
			where
				w.org_code = o.org_code
	</select>
	
	
	<insert id="waterResourcesInsert" parameterType="waterResources">
			    INSERT INTO water_resources (
			        facility_code,
			        facility_category,
			        facility_addr,
			        facility_type,
			        org_code,
			        latitude,
			        longitude
			      <!--   ,create_datetime,
			        modify_datetime -->
			    ) VALUES (
			        #{facility_code},
			        #{facility_category},
			        #{facility_addr},
			        #{facility_type},
			        #{org_code},
			        #{latitude},
			        #{longitude}
			       <!--  ,#{create_datetime},
			        #{modify_datetime} -->
			    );
	</insert>


	
	
	
	
	<select id="findfacilityCategory" resultType="waterResources">
		select 
			facility_category
		from 
			water_resources 
		group by 
			facility_category
		
	</select>
	
	
	
	
	<select id="organizationCategory" resultType="Organization">
		select 
			org_code ,org_name,org_area  
		from 
			Organization
	</select>
	
	
	
	<select id="facilityCategoryType" resultType="code" parameterType="String">
	    SELECT 
	        cate_code, cate_name
	    FROM 
	        code
	    WHERE 
	        field_name = 'facility_type' AND cate_code like '%' || #{divison} || '%'
	    ORDER BY 
	        cate_code
	</select>

	
</mapper>

