<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.postgres.sample.service.impl.dao.kjo.Kjo_WaterResourcesDAO">
	
    <select id="cntWaterResource" resultType="waterResources">
		select count(*) as total
			from water_resources wr, organization org
			where wr.org_code = org.org_code
    </select>
    
    <select id="findFacilityCategory" resultType="waterResources">
		select facility_category from water_resources
			group by facility_category
    </select>
    
    <select id="findFacilityAddr" resultType="waterResources">
		select facility_addr from water_resources
			group by facility_addr
			order by facility_addr
    </select>
   
    <select id="findWaterResourceLists" resultType="waterResources">
	select  ROW_NUMBER() over() as rn, * from
		(select wr.*, org.org_name, split_part(wr.facility_addr::varchar, ' ', 1) as first_area, split_part(wr.facility_addr::varchar, ' ', 2)as second_area
		from water_resources wr, organization org
		where wr.org_code = org.org_code
		order by facility_code)
    </select>

    <select id="PaingWaterResourceLists" parameterType="waterResources" resultType="waterResources">
	select  ROW_NUMBER() over() as rn, * from
		(select cd.cate_name, wr.*, org.org_name, split_part(wr.facility_addr::varchar, ' ', 1) as first_area, split_part(wr.facility_addr::varchar, ' ', 2)as second_area
		from water_resources wr, organization org, code cd
		where wr.org_code = org.org_code and wr.facility_type = cd.cate_code
		order by facility_code)
	offset #{start}-1 limit 10
    </select>
    
    <select id="findFacilityAddrbyCategory" parameterType="waterResources" resultType="waterResources">
    	select  * from
		(select wr.facility_addr
		from water_resources wr, organization org
		where wr.org_code = org.org_code
		 and wr.facility_category = #{facility_category}
		order by facility_code)
    </select>

    <select id="searchWaterResources" parameterType="waterResources" resultType="waterResources">
		select  * from
		(select ROW_NUMBER() over() as rn,  wr.*,cd.cate_name, (select org_name from organization where org_area like '%' || #{org_area} || '%'),split_part(wr.facility_addr::varchar, ' ', 1) as first_area, split_part(wr.facility_addr::varchar, ' ', 2)as second_area
			from water_resources wr, organization org, code cd
				where wr.org_code = org.org_code and wr.facility_type = cd.cate_code
				<if test="facility_category != ''">
					and wr.facility_category = #{facility_category}
				</if>
				<if test="facility_addr != ''">
					and wr.org_area like '%' || #{org_area} || '%'
				</if>
				<if test="facility_code != ''">
					and wr.facility_code like '%' || #{facility_code} || '%'
				</if>
				<if test="cate_name != ''">
					and cd.cate_name like '%' || #{cate_name} || '%'
				</if>
		order by rn)
		where rn between #{start} and #{end}
    </select>

	<select id="searchCnt" parameterType="waterResources" resultType="waterResources">
		select  count(*) as total from
		(select ROW_NUMBER() over() as rn,  wr.*,cd.cate_name, (select org_name from organization where org_area like '%' || #{org_area} || '%'),split_part(wr.facility_addr::varchar, ' ', 1) as first_area, split_part(wr.facility_addr::varchar, ' ', 2)as second_area
		from water_resources wr, organization org, code cd
		where wr.org_code = org.org_code and wr.facility_type = cd.cate_code
		<if test="facility_category != ''">
			and wr.facility_category = #{facility_category}
		</if>
		<if test="facility_addr != ''">
			and wr.org_area like '%' || #{org_area} || '%'
		</if>
		<if test="facility_code != ''">
			and wr.facility_code like '%' || #{facility_code} || '%'
		</if>
		<if test="cate_name != ''">
			and cd.cate_name like '%' || #{cate_name} || '%'
		</if>
		)
	</select>
    <select id="findWaterResourcesById" parameterType="waterResources" resultType="waterResources">
		select * from water_resources wr, code cd where wr.facility_type = cd.cate_code and wr.facility_code = #{facility_code}
    </select>
</mapper>